# sudo env ANSIBLE_NOCOWS=1 ansible-playbook --tags postman local.yml
---

# Get main user for certain packages
- name: Get Main User For Scripts
  tags: [extras,3rd-packages,packages,postman]
  shell: id -nu 1000
  register: get_user_by_id
- name: Register Main User
  tags: [extras,3rd-packages,packages,postman]
  set_fact:
    user: "{{get_user_by_id.stdout}}"
- debug:
    var: user

- name: Postman | mkdir
  tags: [extras,3rd-packages,packages,postman]
  file:
    path: '/home/{{user}}/opt/Postman'
    state: directory
    mode: 0750
    owner: '{{user}}'
    group: '{{user}}'
- name: Postman | Download package
  tags: [extras,3rd-packages,packages,postman]
  unarchive:
    src: https://dl.pstmn.io/download/latest/linux64
    dest: '/home/{{user}}/opt/Postman'
    remote_src: yes
    extra_opts: [--strip-components=1]
    owner: '{{user}}'
    group: '{{user}}'
- name: Postman | Download Logo
  tags: [extras,3rd-packages,packages,postman]
  get_url:
    url: https://www.getpostman.com/img/v2/products/equation-postman.svg
    dest: '/home/{{user}}/opt/Postman/Postman.svg'
    mode: 0640
    owner: '{{user}}'
    group: '{{user}}'
- name: Postman | Create launcher
  tags: [extras,3rd-packages,packages,postman]
  template:
    src: files/Postman.desktop
    dest: '/home/{{user}}/.local/share/applications/Postman.desktop'
    mode: 0640
    owner: '{{user}}'
    group: '{{user}}'
- name: Update launcher
  tags: [extras,3rd-packages,packages,postman]
  lineinfile:
    path: '/home/{{user}}/.local/share/applications/Postman.desktop'
    regexp: '^{{item.key}}='
    line: '{{item.key}}={{item.value}}'
  with_items:
    - { key: 'Exec', value: '/home/{{user}}/opt/Postman/Postman' }
    - { key: 'Icon', value: '/home/{{user}}/opt/Postman/Postman.svg' }
